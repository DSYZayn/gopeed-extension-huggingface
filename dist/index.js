(()=>{"use strict";function e(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||t(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}gopeed.events.onResolve((async function(r){try{var n=new URL(r.req.url),a=n.host,o="www.modelscope.cn"===a?"master":"main",l=n.protocol,i=n.port||("https:"===l?443:80),c=n.pathname.substring(1).split("/");if(c.includes("resolve")||c.includes("spaces"))return;""===c[c.length-1]&&c.pop(),"models"!=c[0]&&"datasets"!=c[0]&&"spaces"!=c[0]&&(c=["models"].concat(e(c)));var s=(m=c.slice(1,3),b=2,function(e){if(Array.isArray(e))return e}(m)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,i=[],c=!0,s=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(s)throw a}}return i}}(m,b)||t(m,b)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],g=s[1];3===c.length&&(c=[].concat(e(c),["tree","main"])),gopeed.logger.debug("user:",u,"repo:",g);var p="",d=function(e){return 0===e.length?[]:"tree"===e[e.length-2]?e:(gopeed.logger.debug("basePathParts:",e),p=""===p?e.pop():e.pop()+"/"+p,gopeed.logger.debug("function basePathParts--filepath:",p),d(e))},f=d(c).join("/");f=f.replace("master","main");var h=await async function e(t,r){gopeed.logger.debug("basePath:",t,"filepath:",r);var n=r?"".concat(t,"/").concat(r):t,a="https://hf-mirror.com/api/".concat(n);gopeed.logger.debug("apiPath:",a,"path:",n);var o=await fetch(a,{headers:{Accept:"application/json"}});if(!o.ok)throw new Error("Failed to fetch ".concat(a));var l=await o.json();return(await Promise.all(l.map((async function(r){return"directory"===r.type?await e(t,r.path):r})))).flat(1/0)}(f,p);r.res={name:u,files:function(e,t,r,n,a,o,l){return null==e?(gopeed.logger.debug("walkFiles: data is undefined or null"),[]):(gopeed.logger.debug("walkFiles: data is not undefined or null"),e.map((function(e){gopeed.logger.debug("item.path:",e.path);var i=r.replace("tree","resolve").replace("main","".concat(t));"main"==t&&r.includes("models")&&(i=i.replace("models/",""));var c=e.path,s="";return c.includes("/")&&(s="/"+(c=e.path.split("/")).slice(0,-1).join("/"),c=c[c.length-1]),i=i.replace(new RegExp("".concat(s,"(?!.*").concat(s,")"),"g"),""),gopeed.logger.debug("a_path:",i),gopeed.logger.debug("name:",c),gopeed.logger.debug("b_path:",s),{name:c,path:"".concat(l).concat(s),size:e.size,req:{url:"".concat(n,"//").concat(a,":").concat(o,"/").concat(i).concat(s,"/").concat(c),extra:{header:{Cookie:gopeed.settings.cookie}}}}})))}(h,o,f,l,a,i,g)},gopeed.logger.debug("ctx.res:",JSON.stringify(r.res))}catch(e){gopeed.logger.error("[HF Parser]",e),r.res={name:"Error",files:[]}}var m,b}))})();