(()=>{"use strict";function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=Array(r);t<r;t++)a[t]=e[t];return a}gopeed.events.onResolve((async function(r){try{var t=new URL(r.req.url),a=t.host,n="www.modelscope.cn"===a?"master":"main",o=t.protocol,c=t.port||("https:"===o?443:80),s=t.pathname.substring(1).split("/");if(s.includes("resolve"))return;"models"!=s[0]&&"datasets"!=s[0]&&"spaces"!=s[0]&&(s=["models"].concat(function(r){if(Array.isArray(r))return e(r)}(d=s)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(d)||function(r,t){if(r){if("string"==typeof r)return e(r,t);var a={}.toString.call(r).slice(8,-1);return"Object"===a&&r.constructor&&(a=r.constructor.name),"Map"===a||"Set"===a?Array.from(r):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(r,t):void 0}}(d)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));var i=s.join("/");i=i.replace("master","main"),gopeed.logger.debug(i);var l="https://hf-mirror.com/api/".concat(i);gopeed.logger.debug(l);var u=await fetch(l,{headers:{Accept:"application/json"}});if(!u.ok)throw new Error("API Error: ".concat(u.status," ").concat(await u.text()));var m=await u.json();gopeed.logger.debug(s);var p=s.filter((function(e){return"tree"!=e&&"main"!=e&&"models"!=e&&"datasets"!=e})).join("_");r.res={name:p,files:(f=m,f.flatMap((function(e){if("file"!=e.type)return[];"main"==n&&i.includes("models")&&(i=i.replace("models/",""));var r=e.path.split("/");return{name:r=r[r.length-1],size:e.size,req:{url:"".concat(o,"//").concat(a,":").concat(c,"/").concat(i.replace("tree","resolve").replace("main","".concat(n)),"/").concat(r)}}})))}}catch(e){console.error("[HF Parser]",e),r.res={error:{message:"解析失败: ".concat(e.message),details:e.stack}}}var d,f}))})();