(()=>{"use strict";function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}async function n(e,r){gopeed.logger.debug("basePath:",e,"filepath:",r);var t=r?"".concat(e,"/").concat(r):e,o="https://hf-mirror.com/api/".concat(t);gopeed.logger.debug("apiPath:",o,"path:",t);var a=await fetch(o,{headers:{Accept:"application/json"}});if(!a.ok)throw new Error("Failed to fetch ".concat(o));var l=await a.json();return(await Promise.all(l.map((async function(r){return"directory"===r.type?await n(e,r.path):r})))).flat(1/0)}function o(e,r,t,n,o,a,l){return null==e?(gopeed.logger.debug("walkFiles: data is undefined or null"),[]):(gopeed.logger.debug("walkFiles: data is not undefined or null"),e.map((function(e){gopeed.logger.debug("item.path:",e.path);var i=t.replace("tree","resolve").replace("main","".concat(r));"main"==r&&t.includes("models")&&(i=i.replace("models/",""));var c=e.path,u="";return c.includes("/")&&(u="/"+(c=e.path.split("/")).slice(0,-1).join("/"),c=c[c.length-1]),i=i.replace(new RegExp("".concat(u,"(?!.*").concat(u,")"),"g"),""),gopeed.logger.debug("aPath:",i),gopeed.logger.debug("name:",c),gopeed.logger.debug("bPath:",u),{name:c,path:"".concat(l).concat(u),size:e.size,req:{url:"".concat(n,"//").concat(o,":").concat(a,"/").concat(i).concat(u,"/").concat(c),extra:{header:{Cookie:gopeed.settings.cookie}}}}})))}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}gopeed.events.onResolve((async function(t){try{var l=function(t){var n,o,a=t.host,l="www.modelscope.cn"===a?"master":"main",i=t.protocol,c=t.port||("https:"===i?443:80),u=t.pathname.substring(1).split("/");if(!u.includes("resolve")&&!u.includes("spaces")){""===u[u.length-1]&&u.pop(),"models"!=u[0]&&"datasets"!=u[0]&&"spaces"!=u[0]&&(u=["models"].concat(e(u)));var s=(n=u.slice(1,3),o=2,function(e){if(Array.isArray(e))return e}(n)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}(n,o)||r(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=s[0],g=s[1];return 3===u.length&&(u=[].concat(e(u),["tree","main"])),gopeed.logger.debug("user:",p,"repo:",g),{baseUrl:a,user:p,repo:g,branch:l,protocol:i,port:c,pathParts:u}}}(new URL(t.req.url)),i=l.baseUrl,c=l.user,u=l.repo,s=l.branch,p=l.protocol,g=l.port,f=function(e){var r="",t=function(e){return 0===e.length?[]:"tree"===e[e.length-2]?e:(gopeed.logger.debug("basePathParts:",e),r=""===r?e.pop():e.pop()+"/"+r,gopeed.logger.debug("function basePathParts--filepath:",r),t(e))};return[t(e).join("/").replace("master","main"),r]}(l.pathParts),d=(v=2,function(e){if(Array.isArray(e))return e}(y=f)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,a,l,i=[],c=!0,u=!1;try{if(a=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=a.call(t)).done)&&(i.push(n.value),i.length!==r);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}(y,v)||function(e,r){if(e){if("string"==typeof e)return a(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,r):void 0}}(y,v)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),h=d[0],m=d[1],b=await n(h,m);t.res={name:c,files:o(b,s,h,p,i,g,u)},gopeed.logger.debug("ctx.res:",JSON.stringify(t.res))}catch(e){gopeed.logger.error("[HF Parser]",e),t.res={name:"Error",files:[]}}var y,v}))})();